# Railpack Configuration for VERA FastAPI Backend
# Ensures Railway builds the FastAPI app, not the Streamlit app

[project]
name = "vera-api"
language = "python"

[build]
# Python version (must be 3.12 or lower for embedchain compatibility)
pythonVersion = "3.12"

# Build commands - explicitly use vera-api/requirements.txt
installCommand = "cd vera-api && pip install --upgrade pip && pip install -r requirements.txt"

[start]
# Start command for the application (run from vera-api directory)
command = "cd vera-api && uvicorn app.main:app --host 0.0.0.0 --port $PORT"

[health]
# Health check configuration
path = "/health"
timeout = 100

[environment]
# Environment type
type = "production"

# Python-specific settings
PYTHONUNBUFFERED = "1"
PYTHONDONTWRITEBYTECODE = "1"

[watch]
# Only trigger rebuilds for changes in vera-api directory
include = [
    "vera-api/app/**/*.py",
    "vera-api/requirements.txt",
    "vera-api/alembic.ini",
    "vera-api/alembic/**/*.py"
]

# Ignore these paths
exclude = [
    "vera-api/__pycache__/**",
    "vera-api/*.pyc",
    "vera-api/alembic/versions/**",
    "vera-api/audio_files/**",
    "vera-api/.env",
    "vera-api/*.log"
]
